<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Product Manager</title>
    
    <!-- Ø®Ø·ÙˆØ· Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #fff;
            min-height: 100vh;
            direction: rtl;
        }

        header {
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo i {
            font-size: 26px;
            color: #00c6ff;
        }

        header h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        nav {
            display: flex;
            gap: 10px;
        }

        nav button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 10px 18px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        nav button:hover {
            background: rgba(0, 198, 255, 0.2);
            transform: translateY(-2px);
        }

        nav button.active {
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            color: #000;
            box-shadow: 0 4px 12px rgba(0, 198, 255, 0.3);
        }

        .container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 18px;
            padding: 24px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            font-size: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #00c6ff;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #ddd;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #00c6ff;
            box-shadow: 0 0 0 2px rgba(0, 198, 255, 0.2);
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            margin-top: 10px;
        }

        .file-input-container input[type="file"] {
            position: absolute;
            top: 0;
            right: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px;
            background: rgba(0, 198, 255, 0.1);
            border: 2px dashed rgba(0, 198, 255, 0.5);
            border-radius: 10px;
            cursor: pointer;
            color: #00c6ff;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            background: rgba(0, 198, 255, 0.2);
        }

        button.main {
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            color: #000;
            font-weight: bold;
            cursor: pointer;
            padding: 16px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            margin-top: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        button.main:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 198, 255, 0.4);
        }

        button.main:active {
            transform: translateY(0);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .button-group button {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .btn-edit:hover {
            background: rgba(255, 193, 7, 0.3);
        }

        .btn-delete {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .btn-delete:hover {
            background: rgba(220, 53, 69, 0.3);
        }

        .btn-update {
            background: linear-gradient(90deg, #4cd964, #2ecc71);
            color: #000;
        }

        .btn-update:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(76, 217, 100, 0.4);
        }

        .btn-cancel {
            background: rgba(108, 117, 125, 0.2);
            color: #6c757d;
        }

        .btn-cancel:hover {
            background: rgba(108, 117, 125, 0.3);
        }

        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .product:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
        }

        .product-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .product-info {
            padding: 18px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #fff;
        }

        .product-category {
            display: inline-block;
            background: rgba(0, 198, 255, 0.15);
            color: #00c6ff;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            margin-bottom: 12px;
        }

        .product-details {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 15px;
        }

        .product-price {
            color: #4cd964;
            font-weight: 700;
        }

        .product-quantity {
            color: #ffcc00;
            font-weight: 700;
        }

        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .order-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            border-left: 4px solid #00c6ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-info h4 {
            font-size: 17px;
            margin-bottom: 5px;
        }

        .order-details {
            display: flex;
            gap: 20px;
            color: #ccc;
            font-size: 14px;
        }

        .order-status {
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 13px;
        }

        .status-pending {
            background: rgba(255, 204, 0, 0.2);
            color: #ffcc00;
        }

        .status-processing {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }

        .status-shipped {
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
        }

        .status-delivered {
            background: rgba(76, 217, 100, 0.2);
            color: #4cd964;
        }

        .status-completed {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .status-cancelled {
            background: rgba(255, 59, 48, 0.2);
            color: #ff3b30;
        }

        .page-title {
            font-size: 28px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #fff;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #aaa;
        }

        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 22px;
            margin-bottom: 10px;
            color: #ccc;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 22px;
            text-align: center;
            border-top: 4px solid;
        }

        .stat-card.products-stat {
            border-color: #00c6ff;
        }

        .stat-card.orders-stat {
            border-color: #4cd964;
        }

        .stat-card.sales-stat {
            border-color: #ffcc00;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
        }

        .stat-label {
            color: #aaa;
            font-size: 15px;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 10px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border-right: 5px solid #00c6ff;
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.5s ease;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification i {
            font-size: 24px;
            color: #00c6ff;
        }

        .close-notification {
            background: none;
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #00c6ff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .action-buttons button {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s ease;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateY(-50px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 22px;
            color: #00c6ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
        }

        .bulk-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .bulk-actions button {
            padding: 10px 16px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .bulk-delete {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .bulk-delete:hover {
            background: rgba(220, 53, 69, 0.3);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .categories-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .category-tag {
            background: rgba(0, 198, 255, 0.15);
            color: #00c6ff;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-tag:hover {
            background: rgba(0, 198, 255, 0.25);
            transform: translateY(-2px);
        }

        .order-details-modal {
            max-width: 700px;
        }

        .order-items-list {
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .order-item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            padding: 10px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .order-item-row:last-child {
            border-bottom: none;
        }

        .order-item-row.header {
            background: rgba(255, 255, 255, 0.05);
            font-weight: bold;
        }

        .customer-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .payment-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .summary-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .info-label {
            color: #aaa;
        }

        .info-value {
            font-weight: bold;
            color: #fff;
        }

        .btn-status {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }

        .btn-status-completed {
            background: rgba(76, 217, 100, 0.2);
            color: #4cd964;
        }

        .btn-status-pending {
            background: rgba(255, 204, 0, 0.2);
            color: #ffcc00;
        }

        .btn-status-cancelled {
            background: rgba(255, 59, 48, 0.2);
            color: #ff3b30;
        }

        /* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØµÙˆØ± */
        .image-preview {
            margin-top: 15px;
            text-align: center;
        }
        
        .image-preview img {
            max-width: 200px;
            max-height: 150px;
            border-radius: 10px;
            border: 2px solid rgba(0, 198, 255, 0.3);
        }
        
        .payment-proof-image {
            max-width: 300px;
            max-height: 200px;
            border-radius: 10px;
            margin: 10px 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .payment-proof-image:hover {
            transform: scale(1.05);
        }
        
        .imgbb-info {
            background: rgba(0, 198, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
            font-size: 12px;
            color: #00c6ff;
        }

        /* WhatsApp Button Styles */
        .whatsapp-btn {
            background: linear-gradient(90deg, #25D366, #128C7E);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            margin-top: 10px;
            width: 100%;
        }

        .whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3);
        }

        .whatsapp-btn.small {
            padding: 6px 12px;
            font-size: 13px;
            width: auto;
            margin-top: 0;
        }

        .whatsapp-info {
            background: rgba(37, 211, 102, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid rgba(37, 211, 102, 0.3);
        }

        .whatsapp-info h4 {
            color: #25D366;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* WhatsApp Modal Styles */
        .whatsapp-modal {
            max-width: 500px;
        }

        .whatsapp-preview {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(37, 211, 102, 0.3);
        }

        .whatsapp-preview h5 {
            color: #25D366;
            margin-bottom: 10px;
        }

        .whatsapp-preview pre {
            color: #fff;
            font-family: inherit;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            nav {
                width: 100%;
                justify-content: center;
            }
            
            .products {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .bulk-actions {
                flex-direction: column;
            }
            
            .order-item-row {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            
            .modal {
                width: 95%;
                padding: 15px;
            }
            
            .payment-proof-image {
                max-width: 200px;
                max-height: 150px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .products {
                grid-template-columns: 1fr;
            }
            
            .order-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .modal {
                width: 95%;
                padding: 15px;
            }
            
            .payment-proof-image {
                max-width: 150px;
                max-height: 100px;
            }
        }
    </style>
</head>

<body>

<header>
    <div class="logo">
        <i class="fas fa-boxes"></i>
        <h1>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ØªØ¬Ø± - Ø·Ù„Ø¨Ø§Øª</h1>
    </div>
    <nav>
        <button id="productsBtn" onclick="showProducts()" class="active">
            <i class="fas fa-box-open"></i>
            Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        </button>
        <button id="ordersBtn" onclick="showOrders()">
            <i class="fas fa-shopping-cart"></i>
            Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        </button>
    </nav>
</header>

<div class="container">

    <!-- PRODUCTS PAGE -->
    <div id="productsPage">
        <h2 class="page-title">
            <i class="fas fa-boxes"></i>
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        </h2>
        
        <div class="stats">
            <div class="stat-card products-stat">
                <i class="fas fa-box-open fa-2x"></i>
                <div class="stat-value" id="totalProducts">0</div>
                <div class="stat-label">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</div>
            </div>
            <div class="stat-card orders-stat">
                <i class="fas fa-shopping-cart fa-2x"></i>
                <div class="stat-value" id="totalOrders">0</div>
                <div class="stat-label">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</div>
            </div>
            <div class="stat-card sales-stat">
                <i class="fas fa-chart-line fa-2x"></i>
                <div class="stat-value" id="totalSales">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
            </div>
        </div>

        <div class="card">
            <h3 id="formTitle"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
            
            <input type="hidden" id="editProductId">
            
            <div class="input-group">
                <label for="name">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ *</label>
                <input type="text" id="name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            </div>
            
            <div class="input-group">
                <label for="category">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬ *</label>
                <input type="text" id="category" placeholder="Ø£Ø¯Ø®Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø«Ø§Ù„: Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§ØªØŒ Ù…Ù„Ø§Ø¨Ø³ØŒ Ø£Ø«Ø§Ø«)">
                <div class="categories-list" id="commonCategories">
                    <span class="category-tag" onclick="setCategory('ÙÙŠØ²Ø§ Ø£Ù…Ø±ÙŠÙƒÙŠ')">ÙÙŠØ²Ø§ Ø£Ù…Ø±ÙŠÙƒÙŠ</span>
                    <span class="category-tag" onclick="setCategory('ÙÙŠØ²Ø§ Ø£ÙˆØ±ÙˆØ¨ÙŠ')">ÙÙŠØ²Ø§ Ø£ÙˆØ±ÙˆØ¨ÙŠ</span>
                    <span class="category-tag" onclick="setCategory('ÙÙŠØ²Ø§ Ø®Ù„ÙŠØ¬ÙŠ')">ÙÙŠØ²Ø§ Ø®Ù„ÙŠØ¬ÙŠ</span>
                    <span class="category-tag" onclick="setCategory('Ø¨Ø§Ø³Ø¨ÙˆØ±')">Ø¨Ø§Ø³Ø¨ÙˆØ±</span>
                    <span class="category-tag" onclick="setCategory('Ø¨Ø·Ø§Ù‚Ø© Ù‡ÙˆÙŠØ©')">Ø¨Ø·Ø§Ù‚Ø© Ù‡ÙˆÙŠØ©</span>
                    <span class="category-tag" onclick="setCategory('Ø´Ù‡Ø§Ø¯Ø§Øª')">Ø´Ù‡Ø§Ø¯Ø§Øª</span>
                    <span class="category-tag" onclick="setCategory('Ù…Ø³ØªÙ†Ø¯Ø§Øª')">Ù…Ø³ØªÙ†Ø¯Ø§Øª</span>
                    <span class="category-tag" onclick="setCategory('Ø£Ø®Ø±Ù‰')">Ø£Ø®Ø±Ù‰</span>
                </div>
            </div>
            
            <div class="input-group">
                <label for="price">Ø§Ù„Ø³Ø¹Ø± (Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡) *</label>
                <input type="number" id="price" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬" min="0" step="0.01">
            </div>
            
            <div class="input-group">
                <label for="quantity">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© *</label>
                <input type="number" id="quantity" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©" min="0">
            </div>
            
            <div class="input-group">
                <label for="description">ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <textarea id="description" rows="3" placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙ Ù„Ù„Ù…Ù†ØªØ¬"></textarea>
            </div>
            
            <div class="input-group">
                <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <div class="file-input-container">
                    <input type="file" id="image" accept="image/*">
                    <label for="image" class="file-input-label">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span id="file-name">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù„Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
                    </label>
                </div>
                <div class="imgbb-info">
                    <i class="fas fa-info-circle"></i> Ø³ÙŠØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ IMGBB ÙˆØªØ®Ø²ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                </div>
                <div class="image-preview" id="imagePreview"></div>
            </div>
            
            <div class="button-group">
                <button class="main" id="addProductBtn" onclick="addProduct()">
                    <i class="fas fa-plus"></i>
                    Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬
                </button>
                <button class="btn-update" id="updateProductBtn" style="display:none" onclick="updateProduct()">
                    <i class="fas fa-save"></i>
                    ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬
                </button>
                <button class="btn-cancel" id="cancelEditBtn" style="display:none" onclick="cancelEdit()">
                    <i class="fas fa-times"></i>
                    Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                </button>
            </div>
        </div>

        <div class="card">
            <h3><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
            
            <div class="bulk-actions">
                <button class="bulk-delete" onclick="showBulkDeleteModal()">
                    <i class="fas fa-trash"></i>
                    Ø­Ø°Ù Ù…Ù†ØªØ¬Ø§Øª Ù…Ø­Ø¯Ø¯Ø©
                </button>
                <button class="main" onclick="refreshProducts()">
                    <i class="fas fa-sync-alt"></i>
                    ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                </button>
            </div>
            
            <div class="products" id="productsList">
                <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø³ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ Ù‡Ù†Ø§ -->
                <div class="empty-state">
                    <div class="loading"></div>
                    <h3>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- ORDERS PAGE -->
    <div id="ordersPage" style="display:none">
        <h2 class="page-title">
            <i class="fas fa-shopping-cart"></i>
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        </h2>
        
        <div class="card">
            <h3><i class="fas fa-clipboard-list"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
            
            <div class="bulk-actions">
                <button class="bulk-delete" onclick="bulkDeleteOrders()">
                    <i class="fas fa-trash"></i>
                    Ø­Ø°Ù Ø·Ù„Ø¨Ø§Øª Ù…Ø­Ø¯Ø¯Ø©
                </button>
                <button class="main" onclick="refreshOrders()">
                    <i class="fas fa-sync-alt"></i>
                    ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                </button>
            </div>
            
            <div class="orders-list" id="ordersList">
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø³ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ Ù‡Ù†Ø§ -->
                <div class="empty-state">
                    <div class="loading"></div>
                    <h3>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</h3>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h3><i class="fas fa-chart-pie"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
            <div id="ordersStats">
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>

</div>

<!-- Ù†Ø§ÙØ°Ø© Ø­Ø°Ù Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<div class="modal-overlay" id="bulkDeleteModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-trash"></i> Ø­Ø°Ù Ù…Ù†ØªØ¬Ø§Øª Ù…Ø­Ø¯Ø¯Ø©</h3>
            <button class="close-modal" onclick="closeBulkDeleteModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="bulkDeleteProductsList">
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± -->
        </div>
        <div class="button-group" style="margin-top: 20px;">
            <button class="btn-delete" onclick="confirmBulkDelete()">
                <i class="fas fa-trash"></i>
                Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯
            </button>
            <button class="btn-cancel" onclick="closeBulkDeleteModal()">
                <i class="fas fa-times"></i>
                Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ -->
<div class="modal-overlay" id="orderDetailsModal">
    <div class="modal order-details-modal">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-file-invoice"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h3>
            <button class="close-modal" onclick="closeOrderDetailsModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div id="orderDetailsContent">
            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </div>
        
        <div class="button-group" style="margin-top: 20px;">
            <button class="btn-cancel" onclick="closeOrderDetailsModal()">
                <i class="fas fa-times"></i>
                Ø¥ØºÙ„Ø§Ù‚
            </button>
        </div>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù -->
<div class="modal-overlay" id="confirmDeleteModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-exclamation-triangle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
            <button class="close-modal" onclick="closeConfirmDeleteModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <p id="deleteMessage" style="margin-bottom: 20px;">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ</p>
        <div class="button-group">
            <button class="btn-delete" onclick="confirmDelete()">
                <i class="fas fa-trash"></i>
                Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù
            </button>
            <button class="btn-cancel" onclick="closeConfirmDeleteModal()">
                <i class="fas fa-times"></i>
                Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ -->
<div class="modal-overlay" id="changeStatusModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-edit"></i> ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
            <button class="close-modal" onclick="closeChangeStatusModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="input-group">
            <label for="newStatus">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
            <select id="newStatus">
                <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                <option value="processing">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                <option value="shipped">ØªÙ… Ø§Ù„Ø´Ø­Ù†</option>
                <option value="delivered">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</option>
                <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                <option value="cancelled">Ù…Ù„ØºÙŠ</option>
            </select>
        </div>
        
        <div class="input-group">
            <label for="statusNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <textarea id="statusNotes" rows="3" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…ÙŠÙ„"></textarea>
        </div>
        
        <div class="whatsapp-info">
            <h4><i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</h4>
            <p style="font-size: 14px; color: #ccc; margin-bottom: 10px;">
                Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„ØªØ­Ø¯ÙŠØ«Ù‡ Ø¨Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            </p>
            <div class="checkbox-group">
                <input type="checkbox" id="sendWhatsApp" checked>
                <label for="sendWhatsApp">Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</label>
            </div>
        </div>
        
        <input type="hidden" id="statusOrderId">
        <input type="hidden" id="statusCustomerPhone">
        <input type="hidden" id="statusOrderNumber">
        
        <div class="button-group">
            <button class="btn-update" onclick="updateOrderStatus()">
                <i class="fas fa-save"></i>
                Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
            </button>
            <button class="btn-cancel" onclick="closeChangeStatusModal()">
                <i class="fas fa-times"></i>
                Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ -->
<div class="modal-overlay" id="whatsappModal">
    <div class="modal whatsapp-modal">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©</h3>
            <button class="close-modal" onclick="closeWhatsAppModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="whatsapp-info">
            <h4><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</h4>
            <div class="info-row">
                <span class="info-label">Ø¥Ù„Ù‰:</span>
                <span class="info-value" id="whatsappCustomerPhone"></span>
            </div>
            <div class="info-row">
                <span class="info-label">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</span>
                <span class="info-value" id="whatsappOrderNumber"></span>
            </div>
        </div>
        
        <div class="whatsapp-preview">
            <h5>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</h5>
            <pre id="whatsappMessagePreview"></pre>
        </div>
        
        <div class="button-group">
            <button class="whatsapp-btn" onclick="sendWhatsAppMessage()">
                <i class="fab fa-whatsapp"></i>
                ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„
            </button>
            <button class="btn-cancel" onclick="closeWhatsAppModal()">
                <i class="fas fa-times"></i>
                Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
        
        <p style="font-size: 12px; color: #aaa; margin-top: 15px; text-align: center;">
            <i class="fas fa-info-circle"></i> Ø³ÙŠØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø¶Ø±Ø©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„
        </p>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹ -->
<div class="modal-overlay" id="paymentProofModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-image"></i> ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹</h3>
            <button class="close-modal" onclick="closePaymentProofModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="paymentProofContent" style="text-align: center;">
            <!-- ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </div>
        <div class="button-group" style="margin-top: 20px;">
            <button class="btn-cancel" onclick="closePaymentProofModal()">
                <i class="fas fa-times"></i>
                Ø¥ØºÙ„Ø§Ù‚
            </button>
        </div>
    </div>
</div>

<!-- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
<div id="notification" class="notification">
    <div class="notification-content">
        <i class="fas fa-check-circle"></i>
        <div>
            <h4 id="notification-title">ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</h4>
            <p id="notification-message">ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­</p>
        </div>
    </div>
    <button class="close-notification" onclick="hideNotification()">
        <i class="fas fa-times"></i>
    </button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    // ========== ØªÙ‡ÙŠØ¦Ø© Firebase ==========
    const firebaseConfig = {
        apiKey: "AIzaSyBDWwS0oydPz7jkZl-fBR0G_0ifVpVs4Pg",
        authDomain: "abozahra-43ac3.firebaseapp.com",
        projectId: "abozahra-43ac3",
        storageBucket: "abozahra-43ac3.firebasestorage.app",
        messagingSenderId: "556658053272",
        appId: "1:556658053272:web:15424479721be40b4980ed",
        measurementId: "G-TEJF82PXET"
    };

    // ØªÙ‡ÙŠØ¦Ø© Firebase
    let db;
    try {
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        db = firebase.firestore();
        console.log("âœ… Firebase initialized successfully");
    } catch (error) {
        console.error("âŒ Error initializing Firebase:", error);
        showNotification("Ø®Ø·Ø£", "ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
    }

    // ========== Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==========
    const IMGBB_API_KEY = "9bd15b9b262c7a1c8e836dd8d921ef60";
    const DEFAULT_IMAGE = "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80";

    let allProducts = [];
    let allOrders = [];
    let selectedProductsForDelete = new Set();
    let selectedOrdersForDelete = new Set();
    let itemToDelete = null;
    let deleteType = null;
    let currentOrderId = null;
    let currentOrderData = null;

    // ========== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ==========

    // Ø¯Ø§Ù„Ø© Ù„ØªØ¹ÙŠÙŠÙ† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
    window.setCategory = (category) => {
        document.getElementById("category").value = category;
    };

    // Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ base64
    function readFileAsDataURL(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ IMGBB
    async function uploadImageToImgBB(file) {
        try {
            console.log("ğŸš€ Ø¨Ø¯Ø¡ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ IMGBB...");
            
            const base64Image = await readFileAsDataURL(file);
            const base64Data = base64Image.split(',')[1];
            
            const formData = new FormData();
            formData.append('key', IMGBB_API_KEY);
            formData.append('image', base64Data);
            formData.append('name', file.name || 'product_image');
            
            const response = await fetch('https://api.imgbb.com/1/upload', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (data.success) {
                console.log("âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­:", data.data.url);
                return {
                    success: true,
                    url: data.data.url,
                    thumbUrl: data.data.thumb?.url || data.data.url,
                    deleteUrl: data.data.delete_url,
                    displayUrl: data.data.display_url
                };
            } else {
                throw new Error(data.error?.message || 'ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©');
            }
            
        } catch (error) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ IMGBB:", error);
            throw error;
        }
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„
    function createStatusUpdateMessage(orderNumber, customerName, newStatus, notes = '') {
        const statusMessages = {
            'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
            'processing': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
            'shipped': 'ØªÙ… Ø§Ù„Ø´Ø­Ù†',
            'delivered': 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„',
            'completed': 'Ù…ÙƒØªÙ…Ù„',
            'cancelled': 'Ù…Ù„ØºÙŠ'
        };
        
        const statusText = statusMessages[newStatus] || newStatus;
        
        let message = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${customerName} ğŸ‘‹\n\n`;
        message += `*ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ*\n`;
        message += `ğŸ“¦ *Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:* ${orderNumber}\n`;
        message += `ğŸ”„ *Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:* ${statusText}\n\n`;
        
        if (notes) {
            message += `ğŸ“ *Ù…Ù„Ø§Ø­Ø¸Ø§Øª:* ${notes}\n\n`;
        }
        
        message += `---\n`;
        message += `Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒ Ø¨Ù†Ø§! ğŸ˜Š\n`;
        message += `Ù…ØªØ¬Ø± Ø·Ù„Ø¨Ø§Øª - Ù„Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ\n`;
        message += `ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 01029149379`;
        
        return message;
    }

    // Ø¯Ø§Ù„Ø© Ù„ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ø±Ø³Ø§Ù„Ø© Ù…Ø®ØµØµØ©
    function openWhatsAppWithMessage(phone, message) {
        // ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
        const cleanedPhone = phone.replace(/\D/g, '');
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        let finalPhone = cleanedPhone;
        if (!finalPhone.startsWith('20')) {
            finalPhone = '20' + finalPhone;
        }
        
        // ØªØ±Ù…ÙŠØ² Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        const encodedMessage = encodeURIComponent(message);
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨
        const whatsappUrl = `https://wa.me/${finalPhone}?text=${encodedMessage}`;
        
        // ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
        window.open(whatsappUrl, '_blank');
        
        return whatsappUrl;
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function showNotification(title, message, type = "info") {
        const notification = document.getElementById("notification");
        const notificationTitle = document.getElementById("notification-title");
        const notificationMessage = document.getElementById("notification-message");
        
        if (!notification || !notificationTitle || !notificationMessage) {
            console.log(`[${type.toUpperCase()}] ${title}: ${message}`);
            return;
        }
        
        notificationTitle.textContent = title;
        notificationMessage.textContent = message;
        
        // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
        notification.style.borderRightColor = 
            type === "success" ? "#4cd964" : 
            type === "error" ? "#ff3b30" : 
            type === "warning" ? "#ffcc00" : "#00c6ff";
        
        // ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
        const icon = notification.querySelector("i");
        if (icon) {
            icon.className = 
                type === "success" ? "fas fa-check-circle" : 
                type === "error" ? "fas fa-exclamation-circle" : 
                type === "warning" ? "fas fa-exclamation-triangle" : "fas fa-info-circle";
        }
        
        notification.classList.add("show");
        
        setTimeout(() => {
            hideNotification();
        }, 5000);
    }

    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    window.hideNotification = () => {
        const notification = document.getElementById("notification");
        if (notification) notification.classList.remove("show");
    };

    // ========== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ==========

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase
    async function loadProducts() {
        const productsList = document.getElementById("productsList");
        
        try {
            productsList.innerHTML = '<div class="empty-state"><div class="loading"></div><h3>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</h3></div>';
            
            if (!db) {
                throw new Error("Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ£");
            }
            
            const querySnapshot = await db.collection("products")
                .orderBy("createdAt", "desc")
                .get();
            
            allProducts = [];
            let productsCount = 0;
            let totalSalesValue = 0;

            if (querySnapshot.empty) {
                productsList.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-box-open"></i>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h3>
                        <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯.</p>
                    </div>
                `;
            } else {
                let productsHTML = "";
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    
                    let imageUrl = data.imageURL || data.image || data.imagulBL || DEFAULT_IMAGE;
                    
                    const product = {
                        id: doc.id,
                        name: data.name || "Ù…Ù†ØªØ¬ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…",
                        category: data.category || "Ø£Ø®Ø±Ù‰",
                        price: parseFloat(data.price) || 0,
                        quantity: parseInt(data.quantity) || 0,
                        description: data.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ",
                        image: imageUrl,
                        inStock: (parseInt(data.quantity) || 0) > 0,
                        imgbbData: data.imgbbData,
                        createdAt: data.createdAt || new Date()
                    };
                    
                    allProducts.push(product);
                    productsCount++;
                    totalSalesValue += (product.price || 0) * (product.quantity || 0);

                    productsHTML += `
                        <div class="product">
                            <div class="checkbox-group">
                                <input type="checkbox" id="product-${product.id}" onchange="toggleProductSelection('${product.id}')">
                                <label for="product-${product.id}">ØªØ­Ø¯ÙŠØ¯ Ù„Ù„Ø­Ø°Ù</label>
                            </div>
                            <img src="${product.image}" class="product-img" alt="${product.name}" 
                                 onerror="this.src='${DEFAULT_IMAGE}'">
                            <div class="product-info">
                                <div class="product-name">${product.name}</div>
                                <div class="product-category">${product.category}</div>
                                <p style="color: #ccc; font-size: 14px; margin: 5px 0;">${product.description}</p>
                                <div class="product-details">
                                    <div class="product-price">${product.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡</div>
                                    <div class="product-quantity">
                                        <i class="fas fa-cubes"></i> ${product.quantity}
                                    </div>
                                </div>
                                <div class="action-buttons">
                                    <button onclick="editProduct('${product.id}')" class="btn-edit">
                                        <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                                    </button>
                                    <button onclick="showDeleteConfirmation('${product.id}', 'product', 'Ù…Ù†ØªØ¬')" class="btn-delete">
                                        <i class="fas fa-trash"></i> Ø­Ø°Ù
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                productsList.innerHTML = productsHTML;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const totalProductsElement = document.getElementById("totalProducts");
            const totalSalesElement = document.getElementById("totalSales");
            
            if (totalProductsElement) totalProductsElement.textContent = productsCount;
            if (totalSalesElement) totalSalesElement.textContent = `${totalSalesValue.toFixed(2)} Ø¬Ù†ÙŠÙ‡`;
            
            console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${productsCount} Ù…Ù†ØªØ¬(Ø§Øª) Ù…Ù† Firebase`);
            
        } catch (error) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase:", error);
            productsList.innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                    <p>${error.message}</p>
                    <button onclick="loadProducts()" style="margin-top: 15px; padding: 10px 20px; background: #00c6ff; color: #000; border: none; border-radius: 8px; cursor: pointer;">
                        <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                    </button>
                </div>
            `;
            showNotification("Ø®Ø·Ø£", "ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
        }
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
    async function addProduct() {
        console.log("Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬...");
        
        const name = document.getElementById("name").value.trim();
        const category = document.getElementById("category").value.trim();
        const price = parseFloat(document.getElementById("price").value);
        const quantity = parseInt(document.getElementById("quantity").value);
        const description = document.getElementById("description").value.trim();
        const fileInput = document.getElementById("image");
        const file = fileInput.files[0];
        
        console.log("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬:", { name, category, price, quantity, description });

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
        if (!name) {
            showNotification("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬", "warning");
            document.getElementById("name").focus();
            return;
        }

        if (!category) {
            showNotification("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬", "warning");
            document.getElementById("category").focus();
            return;
        }

        if (!price || isNaN(price) || price <= 0) {
            showNotification("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±", "warning");
            document.getElementById("price").focus();
            return;
        }

        if (!quantity || isNaN(quantity) || quantity < 0) {
            showNotification("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©", "warning");
            document.getElementById("quantity").focus();
            return;
        }

        // ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„Ø²Ø± Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        const addProductBtn = document.getElementById("addProductBtn");
        const originalText = addProductBtn.innerHTML;
        addProductBtn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';
        addProductBtn.disabled = true;

        try {
            let imageURL = DEFAULT_IMAGE;
            let imgbbData = null;
            
            // Ø¥Ø°Ø§ ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø©ØŒ Ù‚Ù… Ø¨Ø±ÙØ¹Ù‡Ø§ Ø¥Ù„Ù‰ IMGBB
            if (file) {
                showNotification("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ IMGBB...", "info");
                
                try {
                    imgbbData = await uploadImageToImgBB(file);
                    imageURL = imgbbData.url;
                    console.log("âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­:", imageURL);
                } catch (uploadError) {
                    console.warn("âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¨Ø³Ø¨Ø¨ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹:", uploadError);
                    showNotification("ØªÙ†Ø¨ÙŠÙ‡", "ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¨Ø³Ø¨Ø¨ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©", "warning");
                }
            }

            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
            const productData = {
                name,
                category,
                price: parseFloat(price.toFixed(2)),
                quantity: parseInt(quantity),
                description: description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ",
                imageURL: imageURL,
                imgbbData: imgbbData,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Firestore
            const docRef = await db.collection("products").add(productData);
            console.log("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ ID:", docRef.id);

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            resetProductForm();

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­
            showNotification("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!", "success");
            loadProducts();
            
        } catch (error) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬:", error);
            showNotification("Ø®Ø·Ø£", `ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}`, "error");
        } finally {
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Øµ Ø§Ù„Ø²Ø± Ø§Ù„Ø£ØµÙ„ÙŠ
            addProductBtn.innerHTML = originalText;
            addProductBtn.disabled = false;
        }
    }

    // Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù†ØªØ¬
    function resetProductForm() {
        document.getElementById("name").value = "";
        document.getElementById("category").value = "";
        document.getElementById("price").value = "";
        document.getElementById("quantity").value = "";
        document.getElementById("description").value = "";
        document.getElementById("image").value = "";
        document.getElementById("file-name").textContent = "Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù„Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)";
        document.getElementById("editProductId").value = "";
        document.getElementById("imagePreview").innerHTML = "";
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        const formTitle = document.getElementById("formTitle");
        const addProductBtn = document.getElementById("addProductBtn");
        const updateProductBtn = document.getElementById("updateProductBtn");
        const cancelEditBtn = document.getElementById("cancelEditBtn");
        
        if (formTitle) formTitle.innerHTML = '<i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯';
        if (addProductBtn) addProductBtn.style.display = "flex";
        if (updateProductBtn) updateProductBtn.style.display = "none";
        if (cancelEditBtn) cancelEditBtn.style.display = "none";
    }

    // ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬
    window.editProduct = async (productId) => {
        try {
            const doc = await db.collection("products").doc(productId).get();
            
            if (!doc.exists) {
                showNotification("Ø®Ø·Ø£", "Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "error");
                return;
            }

            const product = doc.data();

            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
            document.getElementById("name").value = product.name || "";
            document.getElementById("category").value = product.category || "";
            document.getElementById("price").value = product.price || "";
            document.getElementById("quantity").value = product.quantity || "";
            document.getElementById("description").value = product.description || "";
            document.getElementById("editProductId").value = productId;
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const imagePreview = document.getElementById("imagePreview");
            if (imagePreview && product.imageURL) {
                imagePreview.innerHTML = `
                    <p style="color: #4cd964; margin-bottom: 10px;">
                        <i class="fas fa-image"></i> Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:
                    </p>
                    <img src="${product.imageURL}" style="max-width: 200px; max-height: 150px; border-radius: 10px; border: 2px solid rgba(0, 198, 255, 0.3);">
                `;
            }
            
            // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            const formTitle = document.getElementById("formTitle");
            const addProductBtn = document.getElementById("addProductBtn");
            const updateProductBtn = document.getElementById("updateProductBtn");
            const cancelEditBtn = document.getElementById("cancelEditBtn");
            
            if (formTitle) formTitle.innerHTML = '<i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬';
            if (addProductBtn) addProductBtn.style.display = "none";
            if (updateProductBtn) updateProductBtn.style.display = "flex";
            if (cancelEditBtn) cancelEditBtn.style.display = "flex";
            
            showNotification("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", "ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬", "info");
            
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„:", error);
            showNotification("Ø®Ø·Ø£", "ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬", "error");
        }
    };

    // ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬
    window.updateProduct = async () => {
        const productId = document.getElementById("editProductId").value;
        const name = document.getElementById("name").value.trim();
        const category = document.getElementById("category").value.trim();
        const price = parseFloat(document.getElementById("price").value);
        const quantity = parseInt(document.getElementById("quantity").value);
        const description = document.getElementById("description").value.trim();
        const fileInput = document.getElementById("image");
        const file = fileInput.files[0];

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
        if (!name || !category || !price || price <= 0 || !quantity || quantity < 0) {
            showNotification("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­", "warning");
            return;
        }

        // ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„Ø²Ø± Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        const updateProductBtn = document.getElementById("updateProductBtn");
        const originalText = updateProductBtn.innerHTML;
        updateProductBtn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...';
        updateProductBtn.disabled = true;

        try {
            const productDoc = await db.collection("products").doc(productId).get();
            if (!productDoc.exists) {
                throw new Error("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
            }
            
            const currentProduct = productDoc.data();
            
            let updateData = {
                name,
                category,
                price: parseFloat(price.toFixed(2)),
                quantity: parseInt(quantity),
                description: description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ",
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            // Ø¥Ø°Ø§ ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ù‚Ù… Ø¨Ø±ÙØ¹Ù‡Ø§
            if (file) {
                showNotification("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ IMGBB...", "info");
                
                try {
                    const imgbbData = await uploadImageToImgBB(file);
                    updateData.imageURL = imgbbData.url;
                    updateData.imgbbData = imgbbData;
                    console.log("âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­");
                } catch (uploadError) {
                    console.warn("âš ï¸ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©:", uploadError);
                    showNotification("ØªÙ†Ø¨ÙŠÙ‡", "ØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "warning");
                    updateData.imageURL = currentProduct.imageURL;
                    updateData.imgbbData = currentProduct.imgbbData;
                }
            } else {
                updateData.imageURL = currentProduct.imageURL;
                updateData.imgbbData = currentProduct.imgbbData;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Firebase
            await db.collection("products").doc(productId).update(updateData);

            resetProductForm();
            showNotification("Ù†Ø¬Ø§Ø­", "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­", "success");
            loadProducts();
            
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬:", error);
            showNotification("Ø®Ø·Ø£", `ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}`, "error");
        } finally {
            updateProductBtn.innerHTML = originalText;
            updateProductBtn.disabled = false;
        }
    };

    // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    window.cancelEdit = () => {
        resetProductForm();
        showNotification("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", "ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„", "info");
    };

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    window.refreshProducts = () => {
        loadProducts();
        showNotification("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...", "info");
    };

    // ========== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ==========

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Firebase
    async function loadOrders() {
        const ordersList = document.getElementById("ordersList");
        if (!ordersList) return;
        
        try {
            ordersList.innerHTML = '<div class="empty-state"><div class="loading"></div><h3>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</h3></div>';
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Firestore
            const querySnapshot = await db.collection("orders")
                .orderBy("createdAt", "desc")
                .get();
            
            allOrders = [];
            let ordersCount = 0;
            let pendingOrders = 0;
            let completedOrders = 0;
            let cancelledOrders = 0;
            let totalSalesValue = 0;

            if (querySnapshot.empty) {
                ordersList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</h3>
                        <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯.</p>
                    </div>
                `;
            } else {
                let ordersHTML = "";
                
                querySnapshot.forEach((doc) => {
                    const order = {
                        id: doc.id,
                        ...doc.data()
                    };
                    allOrders.push(order);
                    ordersCount++;

                    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨
                    let orderTotal = 0;
                    if (order.summary && order.summary.total) {
                        orderTotal = order.summary.total;
                    } else if (order.payment && order.payment.total) {
                        orderTotal = order.payment.total;
                    } else if (order.total) {
                        orderTotal = order.total;
                    }
                    totalSalesValue += orderTotal;

                    // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„Ø©
                    const status = order.status || 'pending';
                    if (status === 'pending') pendingOrders++;
                    else if (status === 'completed' || status === 'delivered') completedOrders++;
                    else if (status === 'cancelled') cancelledOrders++;

                    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
                    const orderDate = order.createdAt ? 
                        order.createdAt.toDate().toLocaleDateString('ar-EG') : 
                        'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

                    // Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
                    const customerName = order.customer ? 
                        (order.customer.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') : 
                        'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

                    // Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
                    const orderNumber = order.orderNumber || `ORD-${order.id.slice(0, 8)}`;

                    // Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                    const statusText = {
                        'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                        'processing': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
                        'shipped': 'ØªÙ… Ø§Ù„Ø´Ø­Ù†',
                        'delivered': 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„',
                        'completed': 'Ù…ÙƒØªÙ…Ù„',
                        'cancelled': 'Ù…Ù„ØºÙŠ'
                    }[status] || status;

                    // ÙØ¦Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
                    const statusClass = {
                        'pending': 'pending',
                        'processing': 'processing',
                        'shipped': 'shipped',
                        'delivered': 'delivered',
                        'completed': 'completed',
                        'cancelled': 'cancelled'
                    }[status] || 'pending';

                    // Ø­Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨
                    const whatsappSent = order.whatsappSent ? 
                        '<span style="color: #4cd964; font-size: 12px; margin-right: 5px;"><i class="fab fa-whatsapp"></i> ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</span>' : 
                        '<span style="color: #ffcc00; font-size: 12px; margin-right: 5px;"><i class="fab fa-whatsapp"></i> Ù„Ù… ÙŠØ±Ø³Ù„</span>';

                    ordersHTML += `
                        <div class="order-item">
                            <div class="checkbox-group">
                                <input type="checkbox" id="order-${order.id}" onchange="toggleOrderSelection('${order.id}')">
                                <label for="order-${order.id}">ØªØ­Ø¯ÙŠØ¯</label>
                            </div>
                            <div class="order-info">
                                <h4>${orderNumber} ${whatsappSent}</h4>
                                <p>Ø§Ù„Ø¹Ù…ÙŠÙ„: ${customerName}</p>
                                <div class="order-details">
                                    <span><i class="fas fa-calendar"></i> ${orderDate}</span>
                                    <span><i class="fas fa-money-bill"></i> ${orderTotal.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                                    <span><i class="fas fa-box"></i> ${order.items ? order.items.length : 0} Ù…Ù†ØªØ¬</span>
                                </div>
                            </div>
                            <div class="order-status status-${statusClass}">
                                ${statusText}
                            </div>
                            <div class="action-buttons">
                                <button onclick="viewOrderDetails('${order.id}')" class="btn-edit">
                                    <i class="fas fa-eye"></i> ØªÙØ§ØµÙŠÙ„
                                </button>
                                <button onclick="changeOrderStatus('${order.id}')" class="btn-edit">
                                    <i class="fas fa-edit"></i> Ø­Ø§Ù„Ø©
                                </button>
                                <button onclick="showDeleteConfirmation('${order.id}', 'order', 'Ø·Ù„Ø¨')" class="btn-delete">
                                    <i class="fas fa-trash"></i> Ø­Ø°Ù
                                </button>
                            </div>
                        </div>
                    `;
                });

                ordersList.innerHTML = ordersHTML;
                
                // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                updateOrdersStats(ordersCount, pendingOrders, completedOrders, cancelledOrders, totalSalesValue);
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            const totalOrdersElement = document.getElementById("totalOrders");
            const totalSalesElement = document.getElementById("totalSales");
            
            if (totalOrdersElement) totalOrdersElement.textContent = ordersCount;
            if (totalSalesElement) totalSalesElement.textContent = `${totalSalesValue.toFixed(2)} Ø¬Ù†ÙŠÙ‡`;
            
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:", error);
            ordersList.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #ff6b6b;">
                    <i class="fas fa-exclamation-circle fa-2x"></i>
                    <h4>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h4>
                    <p>${error.message}</p>
                </div>
            `;
        }
    }

    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    function updateOrdersStats(total, pending, completed, cancelled, sales) {
        const ordersStats = document.getElementById("ordersStats");
        if (ordersStats) {
            ordersStats.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 24px; font-weight: bold; color: #00c6ff;">${total}</div>
                        <div style="color: #aaa;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 24px; font-weight: bold; color: #ffcc00;">${pending}</div>
                        <div style="color: #aaa;">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 24px; font-weight: bold; color: #4cd964;">${completed}</div>
                        <div style="color: #aaa;">Ù…ÙƒØªÙ…Ù„Ø©</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 24px; font-weight: bold; color: #ff3b30;">${cancelled}</div>
                        <div style="color: #aaa;">Ù…Ù„ØºÙŠØ©</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                    <div style="font-size: 20px; font-weight: bold; color: #9b59b6;">
                        Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª: ${sales.toFixed(2)} Ø¬Ù†ÙŠÙ‡
                    </div>
                </div>
            `;
        }
    }

    // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
    window.viewOrderDetails = async (orderId) => {
        try {
            const doc = await db.collection("orders").doc(orderId).get();
            
            if (!doc.exists) {
                showNotification("Ø®Ø·Ø£", "Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "error");
                return;
            }

            const order = doc.data();
            
            // Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
            const customerName = order.customer ? 
                (order.customer.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') : 
                'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            // Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙŠÙ„
            const customerPhone = order.customer ? 
                (order.customer.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') : 
                'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„
            const customerAddress = order.customer ? 
                (order.customer.address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') : 
                'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨
            const orderDate = order.createdAt ? 
                order.createdAt.toDate().toLocaleDateString('ar-EG') + ' ' + 
                order.createdAt.toDate().toLocaleTimeString('ar-EG') : 
                'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            // Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
            const orderNumber = order.orderNumber || `ORD-${orderId.slice(0, 8)}`;
            
            // Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
            const paymentMethod = order.payment ? 
                (order.payment.method || 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ') : 
                'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ';
            
            // Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
            const status = order.status || 'pending';
            const statusText = {
                'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                'processing': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
                'shipped': 'ØªÙ… Ø§Ù„Ø´Ø­Ù†',
                'delivered': 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„',
                'completed': 'Ù…ÙƒØªÙ…Ù„',
                'cancelled': 'Ù…Ù„ØºÙŠ'
            }[status] || status;
            
            // Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„
            const deliveryMethod = order.deliveryMethod || 
                (order.delivery && order.delivery.method) || 
                'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            const deliveryMethodText = {
                'shipping': 'Ø§Ù„ØªÙˆØµÙŠÙ„',
                'pickup': 'Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±'
            }[deliveryMethod] || deliveryMethod;
            
            // Ø§Ù„Ø¹Ù†Ø§ØµØ±
            let itemsHTML = '';
            if (order.items && Array.isArray(order.items)) {
                order.items.forEach((item, index) => {
                    const itemName = item.name || 'Ù…Ù†ØªØ¬ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
                    const itemPrice = item.price || 0;
                    const itemQuantity = item.quantity || 1;
                    const itemTotal = itemPrice * itemQuantity;
                    
                    itemsHTML += `
                        <div class="order-item-row">
                            <div>${itemName}</div>
                            <div>${itemPrice.toFixed(2)} Ø¬Ù†ÙŠÙ‡</div>
                            <div>${itemQuantity}</div>
                            <div>${itemTotal.toFixed(2)} Ø¬Ù†ÙŠÙ‡</div>
                        </div>
                    `;
                });
            }
            
            // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
            const subtotal = order.summary ? (order.summary.subtotal || 0) : 0;
            const shipping = order.summary ? (order.summary.shipping || 0) : 0;
            const total = order.summary ? (order.summary.total || subtotal + shipping) : (subtotal + shipping);
            
            // ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹
            let paymentProofHTML = '';
            if (order.payment && order.payment.proofUrl) {
                const proofUrl = order.payment.proofUrl;
                paymentProofHTML = `
                    <div style="margin-top: 15px;">
                        <h4 style="color: #00c6ff; margin-bottom: 10px;">ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹</h4>
                        <img src="${proofUrl}" 
                             class="payment-proof-image" 
                             alt="ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹"
                             onclick="viewPaymentProof('${proofUrl}')"
                             style="cursor: pointer;">
                        ${order.payment.proofData ? `
                            <div class="imgbb-info">
                                <i class="fas fa-info-circle"></i> 
                                Ø§Ù„ØµÙˆØ±Ø© Ù…Ø®Ø²Ù†Ø© ÙÙŠ IMGBB - 
                                <a href="${order.payment.proofData.deleteUrl}" target="_blank" style="color: #4cd964;">Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø°Ù</a>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹
            let paymentDetailsHTML = '';
            if (order.payment) {
                paymentDetailsHTML = `
                    <div class="payment-info">
                        <h4 style="margin-bottom: 10px; color: #00c6ff;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹</h4>
                        <div class="info-row">
                            <span class="info-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</span>
                            <span class="info-value">${paymentMethod}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</span>
                            <span class="info-value">${(order.payment.amount || 0).toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:</span>
                            <span class="info-value">${order.payment.status || 'pending'}</span>
                        </div>
                    </div>
                `;
            }
            
            // Ø­Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨
            let whatsappInfoHTML = '';
            if (order.whatsappSent) {
                const whatsappSentDate = order.whatsappSentAt ? 
                    order.whatsappSentAt.toDate().toLocaleString('ar-EG') : 
                    'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                
                whatsappInfoHTML = `
                    <div class="whatsapp-info">
                        <h4><i class="fab fa-whatsapp"></i> Ø­Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</h4>
                        <div class="info-row">
                            <span class="info-label">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:</span>
                            <span class="info-value" style="color: #4cd964;">Ù†Ø¹Ù…</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ÙˆÙ‚Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:</span>
                            <span class="info-value">${whatsappSentDate}</span>
                        </div>
                    </div>
                `;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ HTML Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
            const detailsHTML = `
                <div class="customer-info">
                    <h4 style="margin-bottom: 10px; color: #00c6ff;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
                    <div class="info-row">
                        <span class="info-label">Ø§Ù„Ø§Ø³Ù…:</span>
                        <span class="info-value">${customerName}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ø§Ù„Ù‡Ø§ØªÙ:</span>
                        <span class="info-value">
                            ${customerPhone}
                            <button onclick="sendStatusUpdate('${orderId}', '${customerPhone}', '${customerName}', '${orderNumber}')" 
                                    class="whatsapp-btn small" style="margin-right: 10px;">
                                <i class="fab fa-whatsapp"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…ÙŠÙ„
                            </button>
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span>
                        <span class="info-value">${customerAddress}</span>
                    </div>
                </div>
                
                ${whatsappInfoHTML}
                
                <div class="payment-info">
                    <h4 style="margin-bottom: 10px; color: #00c6ff;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h4>
                    <div class="info-row">
                        <span class="info-label">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</span>
                        <span class="info-value">${orderNumber}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</span>
                        <span class="info-value">${orderDate}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                        <span class="info-value">${deliveryMethodText}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</span>
                        <span class="info-value">${statusText}</span>
                    </div>
                </div>
                
                ${paymentDetailsHTML}
                
                <h4 style="margin: 20px 0 10px 0; color: #00c6ff;">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h4>
                <div class="order-items-list">
                    <div class="order-item-row header">
                        <div>Ø§Ù„Ù…Ù†ØªØ¬</div>
                        <div>Ø§Ù„Ø³Ø¹Ø±</div>
                        <div>Ø§Ù„ÙƒÙ…ÙŠØ©</div>
                        <div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                    </div>
                    ${itemsHTML || '<div style="padding: 20px; text-align: center; color: #aaa;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</div>'}
                </div>
                
                <div class="summary-info">
                    <h4 style="margin-bottom: 10px; color: #00c6ff;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª</h4>
                    <div class="info-row">
                        <span class="info-label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                        <span class="info-value">${subtotal.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø­Ù†:</span>
                        <span class="info-value">${shipping.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                        <span class="info-value" style="color: #4cd964; font-size: 18px;">${total.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                    </div>
                </div>
                
                ${paymentProofHTML}
            `;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø©
            document.getElementById("orderDetailsContent").innerHTML = detailsHTML;
            document.getElementById("orderDetailsModal").classList.add("active");
            
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:", error);
            showNotification("Ø®Ø·Ø£", `ÙØ´Ù„ ÙÙŠ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨: ${error.message}`, "error");
        }
    };

    // Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„
    window.sendStatusUpdate = async (orderId, customerPhone, customerName, orderNumber) => {
        try {
            const doc = await db.collection("orders").doc(orderId).get();
            if (!doc.exists) {
                showNotification("Ø®Ø·Ø£", "Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "error");
                return;
            }

            const order = doc.data();
            const currentStatus = order.status || 'pending';
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©
            document.getElementById("statusOrderId").value = orderId;
            document.getElementById("statusCustomerPhone").value = customerPhone;
            document.getElementById("statusOrderNumber").value = orderNumber;
            document.getElementById("newStatus").value = currentStatus;
            document.getElementById("statusNotes").value = '';
            
            // ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©
            document.getElementById("changeStatusModal").classList.add("active");
            
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨:", error);
            showNotification("Ø®Ø·Ø£", "ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨", "error");
        }
    };

    // Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ ÙÙŠ Ù†Ø§ÙØ°Ø© Ù…Ù†ÙØµÙ„Ø©
    window.viewPaymentProof = (imageUrl) => {
        document.getElementById("paymentProofContent").innerHTML = `
            <img src="${imageUrl}" 
                 style="max-width: 100%; max-height: 400px; border-radius: 10px; margin-bottom: 15px;">
            <p style="margin-top: 10px;">
                <a href="${imageUrl}" target="_blank" style="color: #00c6ff; text-decoration: none;">
                    <i class="fas fa-external-link-alt"></i> ÙØªØ­ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </a>
            </p>
        `;
        document.getElementById("paymentProofModal").classList.add("active");
    };

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹
    window.closePaymentProofModal = () => {
        document.getElementById("paymentProofModal").classList.remove("active");
    };

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
    window.closeOrderDetailsModal = () => {
        document.getElementById("orderDetailsModal").classList.remove("active");
    };

    // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
    window.changeOrderStatus = async (orderId) => {
        try {
            const doc = await db.collection("orders").doc(orderId).get();
            
            if (!doc.exists) {
                showNotification("Ø®Ø·Ø£", "Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "error");
                return;
            }

            const order = doc.data();
            currentOrderData = order;
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById("statusOrderId").value = orderId;
            document.getElementById("statusCustomerPhone").value = order.customer?.phone || '';
            document.getElementById("statusOrderNumber").value = order.orderNumber || `ORD-${orderId.slice(0, 8)}`;
            document.getElementById("newStatus").value = order.status || 'pending';
            document.getElementById("statusNotes").value = order.statusNotes || '';
            
            // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
            document.getElementById("changeStatusModal").classList.add("active");
            
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨:", error);
            showNotification("Ø®Ø·Ø£", "ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨", "error");
        }
    };

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©
    window.closeChangeStatusModal = () => {
        document.getElementById("changeStatusModal").classList.remove("active");
    };

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
    window.updateOrderStatus = async () => {
        const orderId = document.getElementById("statusOrderId").value;
        const newStatus = document.getElementById("newStatus").value;
        const notes = document.getElementById("statusNotes").value.trim();
        const customerPhone = document.getElementById("statusCustomerPhone").value;
        const orderNumber = document.getElementById("statusOrderNumber").value;
        const sendWhatsApp = document.getElementById("sendWhatsApp").checked;
        
        if (!orderId) {
            showNotification("Ø®Ø·Ø£", "Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "error");
            return;
        }
        
        try {
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Firebase
            await db.collection("orders").doc(orderId).update({
                status: newStatus,
                statusNotes: notes || "",
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            showNotification("Ù†Ø¬Ø§Ø­", "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­", "success");
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù…ÙƒÙ†Ø§Ù‹ Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ù…ØªÙˆÙØ±Ø§Ù‹
            if (sendWhatsApp && customerPhone && currentOrderData) {
                const customerName = currentOrderData.customer?.name || 'Ø§Ù„Ø¹Ù…ÙŠÙ„';
                const whatsappMessage = createStatusUpdateMessage(orderNumber, customerName, newStatus, notes);
                
                // Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¹Ø±Ø¶
                window.whatsappMessageToSend = whatsappMessage;
                window.whatsappCustomerPhone = customerPhone;
                window.whatsappOrderNumber = orderNumber;
                window.whatsappOrderId = orderId;
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                document.getElementById("whatsappCustomerPhone").textContent = customerPhone;
                document.getElementById("whatsappOrderNumber").textContent = orderNumber;
                document.getElementById("whatsappMessagePreview").textContent = whatsappMessage;
                
                // ÙØªØ­ Ù†Ø§ÙØ°Ø© ÙˆØ§ØªØ³Ø§Ø¨
                closeChangeStatusModal();
                setTimeout(() => {
                    document.getElementById("whatsappModal").classList.add("active");
                }, 300);
            } else {
                closeChangeStatusModal();
                loadOrders();
            }
            
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:", error);
            showNotification("Ø®Ø·Ø£", `ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨: ${error.message}`, "error");
        }
    };

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨
    window.sendWhatsAppMessage = () => {
        if (!window.whatsappMessageToSend || !window.whatsappCustomerPhone) {
            showNotification("Ø®Ø·Ø£", "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§", "error");
            return;
        }
        
        try {
            // ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            openWhatsAppWithMessage(window.whatsappCustomerPhone, window.whatsappMessageToSend);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Firebase
            if (window.whatsappOrderId) {
                db.collection("orders").doc(window.whatsappOrderId).update({
                    whatsappSent: true,
                    whatsappSentAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
            
            showNotification("Ù†Ø¬Ø§Ø­", "Ø¬Ø§Ø±Ù ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«...", "success");
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            setTimeout(() => {
                closeWhatsAppModal();
                loadOrders();
            }, 2000);
            
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨:", error);
            showNotification("Ø®Ø·Ø£", "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©", "error");
        }
    };

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ÙˆØ§ØªØ³Ø§Ø¨
    window.closeWhatsAppModal = () => {
        document.getElementById("whatsappModal").classList.remove("active");
        // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©
        window.whatsappMessageToSend = null;
        window.whatsappCustomerPhone = null;
        window.whatsappOrderNumber = null;
        window.whatsappOrderId = null;
    };

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    window.refreshOrders = () => {
        loadOrders();
        showNotification("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª...", "info");
    };

    // ========== ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø© ==========

    // Ø­Ø°Ù Ù…Ù†ØªØ¬ Ø£Ùˆ Ø·Ù„Ø¨
    window.showDeleteConfirmation = (id, type, name) => {
        itemToDelete = id;
        deleteType = type;
        const deleteMessage = document.getElementById("deleteMessage");
        const confirmDeleteModal = document.getElementById("confirmDeleteModal");
        
        if (deleteMessage) deleteMessage.textContent = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${name}ØŸ`;
        if (confirmDeleteModal) confirmDeleteModal.classList.add("active");
    };

    window.confirmDelete = async () => {
        if (!itemToDelete || !deleteType) return;

        try {
            if (deleteType === 'product') {
                await db.collection("products").doc(itemToDelete).delete();
                showNotification("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­", "success");
                loadProducts();
            } else if (deleteType === 'order') {
                await db.collection("orders").doc(itemToDelete).delete();
                showNotification("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­", "success");
                loadOrders();
            }
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù:", error);
            showNotification("Ø®Ø·Ø£", `ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù: ${error.message}`, "error");
        } finally {
            closeConfirmDeleteModal();
        }
    };

    window.closeConfirmDeleteModal = () => {
        const confirmDeleteModal = document.getElementById("confirmDeleteModal");
        if (confirmDeleteModal) confirmDeleteModal.classList.remove("active");
        itemToDelete = null;
        deleteType = null;
    };

    // Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
    window.toggleProductSelection = (productId) => {
        if (selectedProductsForDelete.has(productId)) {
            selectedProductsForDelete.delete(productId);
        } else {
            selectedProductsForDelete.add(productId);
        }
    };

    window.showBulkDeleteModal = () => {
        const listContainer = document.getElementById("bulkDeleteProductsList");
        const bulkDeleteModal = document.getElementById("bulkDeleteModal");
        
        if (!listContainer || !bulkDeleteModal) return;
        
        listContainer.innerHTML = "";
        
        if (allProducts.length === 0) {
            listContainer.innerHTML = '<p style="color: #aaa; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø©</p>';
        } else {
            allProducts.forEach(product => {
                listContainer.innerHTML += `
                    <div class="checkbox-group">
                        <input type="checkbox" id="bulk-product-${product.id}" 
                               ${selectedProductsForDelete.has(product.id) ? 'checked' : ''}
                               onchange="toggleProductSelection('${product.id}')">
                        <label for="bulk-product-${product.id}">${product.name} - ${product.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡</label>
                    </div>
                `;
            });
        }
        
        bulkDeleteModal.classList.add("active");
    };

    window.closeBulkDeleteModal = () => {
        const bulkDeleteModal = document.getElementById("bulkDeleteModal");
        if (bulkDeleteModal) bulkDeleteModal.classList.remove("active");
    };

    window.confirmBulkDelete = async () => {
        if (selectedProductsForDelete.size === 0) {
            showNotification("ØªØ­Ø°ÙŠØ±", "Ù„Ù… ØªØ®ØªØ± Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø­Ø°Ù", "warning");
            return;
        }

        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${selectedProductsForDelete.size} Ù…Ù†ØªØ¬(Ø§Øª)ØŸ`)) {
            return;
        }

        try {
            const batch = db.batch();
            selectedProductsForDelete.forEach(productId => {
                const productRef = db.collection("products").doc(productId);
                batch.delete(productRef);
            });
            
            await batch.commit();
            
            showNotification("Ù†Ø¬Ø§Ø­", `ØªÙ… Ø­Ø°Ù ${selectedProductsForDelete.size} Ù…Ù†ØªØ¬(Ø§Øª) Ø¨Ù†Ø¬Ø§Ø­`, "success");
            selectedProductsForDelete.clear();
            closeBulkDeleteModal();
            loadProducts();
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª:", error);
            showNotification("Ø®Ø·Ø£", `ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${error.message}`, "error");
        }
    };

    // Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª
    window.toggleOrderSelection = (orderId) => {
        if (selectedOrdersForDelete.has(orderId)) {
            selectedOrdersForDelete.delete(orderId);
        } else {
            selectedOrdersForDelete.add(orderId);
        }
    };

    window.bulkDeleteOrders = async () => {
        if (selectedOrdersForDelete.size === 0) {
            showNotification("ØªØ­Ø°ÙŠØ±", "Ù„Ù… ØªØ®ØªØ± Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ø­Ø°Ù", "warning");
            return;
        }

        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${selectedOrdersForDelete.size} Ø·Ù„Ø¨(Ø§Øª)ØŸ`)) {
            return;
        }

        try {
            const batch = db.batch();
            selectedOrdersForDelete.forEach(orderId => {
                const orderRef = db.collection("orders").doc(orderId);
                batch.delete(orderRef);
            });
            
            await batch.commit();
            
            showNotification("Ù†Ø¬Ø§Ø­", `ØªÙ… Ø­Ø°Ù ${selectedOrdersForDelete.size} Ø·Ù„Ø¨(Ø§Øª) Ø¨Ù†Ø¬Ø§Ø­`, "success");
            selectedOrdersForDelete.clear();
            loadOrders();
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª:", error);
            showNotification("Ø®Ø·Ø£", `ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨Ø§Øª: ${error.message}`, "error");
        }
    };

    // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
    window.showProducts = () => {
        const productsPage = document.getElementById("productsPage");
        const ordersPage = document.getElementById("ordersPage");
        const productsBtn = document.getElementById("productsBtn");
        const ordersBtn = document.getElementById("ordersBtn");
        
        if (productsPage) productsPage.style.display = "block";
        if (ordersPage) ordersPage.style.display = "none";
        if (productsBtn) productsBtn.classList.add("active");
        if (ordersBtn) ordersBtn.classList.remove("active");
        
        loadProducts();
    };

    window.showOrders = () => {
        const productsPage = document.getElementById("productsPage");
        const ordersPage = document.getElementById("ordersPage");
        const productsBtn = document.getElementById("productsBtn");
        const ordersBtn = document.getElementById("ordersBtn");
        
        if (productsPage) productsPage.style.display = "none";
        if (ordersPage) ordersPage.style.display = "block";
        if (productsBtn) productsBtn.classList.remove("active");
        if (ordersBtn) ordersBtn.classList.add("active");
        
        loadOrders();
    };

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    window.addEventListener("DOMContentLoaded", () => {
        console.log("âœ… Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„...");
        
        // ØªØ¹ÙŠÙŠÙ† Ø­Ø¯Ø« Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©
        const imageInput = document.getElementById("image");
        const fileName = document.getElementById("file-name");
        
        if (imageInput && fileName) {
            imageInput.addEventListener("change", function() {
                if (this.files && this.files[0]) {
                    const file = this.files[0];
                    fileName.textContent = file.name;
                    
                    // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imagePreview = document.getElementById("imagePreview");
                        imagePreview.innerHTML = `
                            <p style="color: #4cd964; margin-bottom: 10px;">
                                <i class="fas fa-image"></i> Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©:
                            </p>
                            <img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: 10px; border: 2px solid rgba(0, 198, 255, 0.3);">
                        `;
                    };
                    reader.readAsDataURL(file);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø©
                    const maxSize = 10 * 1024 * 1024;
                    if (file.size > maxSize) {
                        showNotification("ØªØ­Ø°ÙŠØ±", "Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10MB)", "warning");
                        this.value = "";
                        fileName.textContent = "Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù„Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)";
                        document.getElementById("imagePreview").innerHTML = "";
                    }
                } else {
                    fileName.textContent = "Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù„Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)";
                    document.getElementById("imagePreview").innerHTML = "";
                }
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
        loadProducts();
        loadOrders();
        
        setTimeout(() => {
            showNotification("Ù…Ø±Ø­Ø¨Ø§Ù‹", "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù†Ø¬Ø§Ø­!", "info");
            console.log("âœ… Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…");
        }, 1000);
    });
</script>

</body>
</html>
